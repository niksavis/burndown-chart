{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "DORA Metrics Response Schema",
  "description": "Schema for DORA metrics calculation response including all four metrics with performance tiers",
  "type": "object",
  "required": ["metrics", "time_period", "calculation_timestamp"],
  "properties": {
    "metrics": {
      "type": "object",
      "required": [
        "deployment_frequency",
        "lead_time_for_changes",
        "change_failure_rate",
        "mean_time_to_recovery"
      ],
      "properties": {
        "deployment_frequency": {
          "$ref": "#/definitions/doraMetric",
          "description": "Number of deployments to production per time period"
        },
        "lead_time_for_changes": {
          "$ref": "#/definitions/doraMetric",
          "description": "Average time from code commit to production deployment"
        },
        "change_failure_rate": {
          "$ref": "#/definitions/doraMetric",
          "description": "Percentage of deployments that result in failures or incidents"
        },
        "mean_time_to_recovery": {
          "$ref": "#/definitions/doraMetric",
          "description": "Average time to restore service after an incident"
        }
      },
      "additionalProperties": false
    },
    "time_period": {
      "type": "object",
      "required": ["start_date", "end_date", "display_label"],
      "properties": {
        "start_date": {
          "type": "string",
          "format": "date-time",
          "description": "Start of measurement period (UTC ISO 8601)"
        },
        "end_date": {
          "type": "string",
          "format": "date-time",
          "description": "End of measurement period (UTC ISO 8601)"
        },
        "display_label": {
          "type": "string",
          "description": "Human-readable period label (e.g., 'Last 30 days')"
        }
      }
    },
    "calculation_timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "When these metrics were calculated (UTC ISO 8601)"
    },
    "cache_hit": {
      "type": "boolean",
      "description": "Whether these results came from cache"
    },
    "field_mappings_hash": {
      "type": "string",
      "pattern": "^[a-f0-9]{8}$",
      "description": "MD5 hash of field mappings used for calculation"
    }
  },
  "additionalProperties": false,
  "definitions": {
    "doraMetric": {
      "type": "object",
      "required": [
        "metric_name",
        "value",
        "unit",
        "performance_tier",
        "error_state"
      ],
      "properties": {
        "metric_name": {
          "type": "string",
          "enum": [
            "deployment_frequency",
            "lead_time_for_changes",
            "change_failure_rate",
            "mean_time_to_recovery"
          ]
        },
        "value": {
          "type": ["number", "null"],
          "minimum": 0,
          "description": "Calculated metric value (null if error)"
        },
        "unit": {
          "type": "string",
          "enum": [
            "deployments/day",
            "deployments/week",
            "deployments/month",
            "days",
            "hours",
            "minutes",
            "percentage"
          ]
        },
        "performance_tier": {
          "type": ["string", "null"],
          "enum": ["Elite", "High", "Medium", "Low", null],
          "description": "DORA performance benchmark tier"
        },
        "performance_tier_color": {
          "type": "string",
          "enum": ["green", "yellow", "orange", "red", "gray"],
          "description": "Color coding for performance tier"
        },
        "error_state": {
          "type": "string",
          "enum": [
            "success",
            "missing_mapping",
            "no_data",
            "calculation_error",
            "invalid_date"
          ]
        },
        "error_message": {
          "type": ["string", "null"],
          "maxLength": 500,
          "description": "User-friendly error explanation (null if success)"
        },
        "excluded_issue_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of issues excluded due to missing data"
        },
        "total_issue_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Total issues considered for calculation"
        },
        "details": {
          "type": "object",
          "properties": {
            "benchmark_elite": {
              "type": "number",
              "description": "Elite tier threshold value"
            },
            "benchmark_high": {
              "type": "number",
              "description": "High tier threshold value"
            },
            "benchmark_medium": {
              "type": "number",
              "description": "Medium tier threshold value"
            },
            "benchmark_low": {
              "type": "number",
              "description": "Low tier threshold value"
            },
            "trend_direction": {
              "type": "string",
              "enum": ["up", "down", "stable", "unknown"],
              "description": "Trend compared to previous period"
            },
            "trend_percentage": {
              "type": "number",
              "description": "Percentage change from previous period"
            }
          }
        }
      },
      "additionalProperties": false
    }
  },
  "examples": [
    {
      "metrics": {
        "deployment_frequency": {
          "metric_name": "deployment_frequency",
          "value": 45.2,
          "unit": "deployments/month",
          "performance_tier": "High",
          "performance_tier_color": "yellow",
          "error_state": "success",
          "error_message": null,
          "excluded_issue_count": 2,
          "total_issue_count": 52,
          "details": {
            "benchmark_elite": 100,
            "benchmark_high": 30,
            "benchmark_medium": 5,
            "benchmark_low": 1,
            "trend_direction": "up",
            "trend_percentage": 12.5
          }
        },
        "lead_time_for_changes": {
          "metric_name": "lead_time_for_changes",
          "value": 3.5,
          "unit": "days",
          "performance_tier": "High",
          "performance_tier_color": "yellow",
          "error_state": "success",
          "error_message": null,
          "excluded_issue_count": 0,
          "total_issue_count": 52,
          "details": {
            "benchmark_elite": 0.04,
            "benchmark_high": 7,
            "benchmark_medium": 30,
            "benchmark_low": 180,
            "trend_direction": "down",
            "trend_percentage": -8.3
          }
        },
        "change_failure_rate": {
          "metric_name": "change_failure_rate",
          "value": 18.5,
          "unit": "percentage",
          "performance_tier": "High",
          "performance_tier_color": "yellow",
          "error_state": "success",
          "error_message": null,
          "excluded_issue_count": 0,
          "total_issue_count": 52,
          "details": {
            "benchmark_elite": 15,
            "benchmark_high": 30,
            "benchmark_medium": 46,
            "benchmark_low": 60,
            "trend_direction": "stable",
            "trend_percentage": 0.5
          }
        },
        "mean_time_to_recovery": {
          "metric_name": "mean_time_to_recovery",
          "value": 4.2,
          "unit": "hours",
          "performance_tier": "High",
          "performance_tier_color": "yellow",
          "error_state": "success",
          "error_message": null,
          "excluded_issue_count": 1,
          "total_issue_count": 12,
          "details": {
            "benchmark_elite": 1,
            "benchmark_high": 24,
            "benchmark_medium": 168,
            "benchmark_low": 720,
            "trend_direction": "up",
            "trend_percentage": 15.2
          }
        }
      },
      "time_period": {
        "start_date": "2025-01-01T00:00:00.000Z",
        "end_date": "2025-01-31T23:59:59.999Z",
        "display_label": "Last 30 days"
      },
      "calculation_timestamp": "2025-01-31T10:00:00.000Z",
      "cache_hit": false,
      "field_mappings_hash": "a3f5c8d9"
    }
  ]
}
