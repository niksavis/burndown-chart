{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Field Mapping Configuration Schema",
  "description": "Schema for storing Jira custom field mappings to internal DORA and Flow metric fields",
  "type": "object",
  "required": ["field_mappings", "field_metadata"],
  "properties": {
    "field_mappings": {
      "type": "object",
      "required": ["dora", "flow"],
      "properties": {
        "dora": {
          "type": "object",
          "description": "Mappings for DORA metric calculation fields",
          "properties": {
            "deployment_date": {
              "type": "string",
              "pattern": "^customfield_[0-9]+$|^[a-z]+$",
              "description": "Jira field ID for deployment date (DateTime type required)"
            },
            "target_environment": {
              "type": "string",
              "pattern": "^customfield_[0-9]+$|^[a-z]+$",
              "description": "Jira field ID for target environment (Select type required)"
            },
            "code_commit_date": {
              "type": "string",
              "pattern": "^customfield_[0-9]+$|^[a-z]+$",
              "description": "Jira field ID for code commit date (DateTime type required)"
            },
            "deployed_to_production_date": {
              "type": "string",
              "pattern": "^customfield_[0-9]+$|^[a-z]+$",
              "description": "Jira field ID for production deployment date (DateTime type required)"
            },
            "incident_detected_at": {
              "type": "string",
              "pattern": "^customfield_[0-9]+$|^[a-z]+$",
              "description": "Jira field ID for incident detection timestamp (DateTime type required)"
            },
            "incident_resolved_at": {
              "type": "string",
              "pattern": "^customfield_[0-9]+$|^[a-z]+$",
              "description": "Jira field ID for incident resolution timestamp (DateTime type required)"
            },
            "deployment_successful": {
              "type": "string",
              "pattern": "^customfield_[0-9]+$|^[a-z]+$",
              "description": "Jira field ID for deployment success flag (Checkbox type required)"
            },
            "production_impact": {
              "type": "string",
              "pattern": "^customfield_[0-9]+$|^[a-z]+$",
              "description": "Jira field ID for production impact level (Select type required)"
            }
          },
          "additionalProperties": false
        },
        "flow": {
          "type": "object",
          "description": "Mappings for Flow metric calculation fields",
          "properties": {
            "flow_item_type": {
              "type": "string",
              "pattern": "^customfield_[0-9]+$|^[a-z]+$",
              "description": "Jira field ID for work item type (Select type required, values: Feature, Defect, Risk, Technical_Debt)"
            },
            "work_started_date": {
              "type": "string",
              "pattern": "^customfield_[0-9]+$|^[a-z]+$",
              "description": "Jira field ID for work start date (DateTime type required)"
            },
            "work_completed_date": {
              "type": "string",
              "pattern": "^customfield_[0-9]+$|^[a-z]+$",
              "description": "Jira field ID for work completion date (DateTime type required)"
            },
            "status_entry_timestamp": {
              "type": "string",
              "pattern": "^customfield_[0-9]+$|^[a-z]+$",
              "description": "Jira field ID for status entry timestamp (DateTime type required)"
            },
            "active_work_hours": {
              "type": "string",
              "pattern": "^customfield_[0-9]+$|^[a-z]+$",
              "description": "Jira field ID for active work hours (Number type required)"
            },
            "flow_time_days": {
              "type": "string",
              "pattern": "^customfield_[0-9]+$|^[a-z]+$",
              "description": "Jira field ID for flow time in days (Number type required)"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "field_metadata": {
      "type": "object",
      "description": "Metadata for each mapped field including name, type, and validation rules",
      "patternProperties": {
        "^customfield_[0-9]+$|^[a-z]+$": {
          "type": "object",
          "required": ["name", "type", "required"],
          "properties": {
            "name": {
              "type": "string",
              "minLength": 1,
              "maxLength": 255,
              "description": "Human-readable field name from Jira"
            },
            "type": {
              "type": "string",
              "enum": [
                "datetime",
                "number",
                "text",
                "select",
                "checkbox",
                "multiselect"
              ],
              "description": "Jira field type"
            },
            "required": {
              "type": "boolean",
              "description": "Whether this field is required for metric calculations"
            },
            "description": {
              "type": "string",
              "maxLength": 500,
              "description": "Field purpose explanation"
            },
            "options": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Available options for select/multiselect fields"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "last_updated": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of last configuration update"
    }
  },
  "additionalProperties": false,
  "examples": [
    {
      "field_mappings": {
        "dora": {
          "deployment_date": "customfield_10100",
          "target_environment": "customfield_10101",
          "code_commit_date": "customfield_10102",
          "deployed_to_production_date": "customfield_10103",
          "incident_detected_at": "customfield_10104",
          "incident_resolved_at": "customfield_10105",
          "deployment_successful": "customfield_10106",
          "production_impact": "customfield_10107"
        },
        "flow": {
          "flow_item_type": "customfield_10200",
          "work_started_date": "customfield_10201",
          "work_completed_date": "customfield_10202",
          "status_entry_timestamp": "customfield_10203",
          "active_work_hours": "customfield_10204",
          "flow_time_days": "customfield_10205"
        }
      },
      "field_metadata": {
        "customfield_10100": {
          "name": "Deployment Date",
          "type": "datetime",
          "required": true,
          "description": "When the code was deployed to production"
        },
        "customfield_10200": {
          "name": "Work Type",
          "type": "select",
          "required": true,
          "description": "Category of work item for Flow Distribution",
          "options": ["Feature", "Defect", "Risk", "Technical_Debt"]
        }
      },
      "last_updated": "2025-01-31T10:00:00.000Z"
    }
  ]
}
